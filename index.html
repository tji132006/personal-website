<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Tong's Page</title>

	<style type="text/css">
		*{padding: 0; margin: 0;}
		body, html{
			/*background-color: #fff;*/
			height: 100%;
			color: #555;
			font-family: 'Avenir Next', 'Lantinghei SC';
			font-size: 14px;
			-webkit-font-smoothing: antialiased;
		}

		.content{
			
			height: 100%;
			background-image: url("timg.jpg");
			background-position: center;
    		background-repeat: no-repeat;
    		background-size: cover;	
		}

		.wrap{
			background-color: blue;
			width: 90%;
			height: 80%;
			/*centered both H and V w/ unknow width*/
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			overflow:hidden;
			-webkit-perspective: 800px;
		}

		/*海报样式*/
		.photo{
			width: 260px;
			height: 320px;
			position: absolute;
			z-index: 1;
			box-shadow: 0 0 1px rgba(0,0,0, .01);

		}
		.photo .side{
			width: 100%;
			height: 100%;
			background-color: #eee;
			position: absolute;
			top: 0;
			right: 0;
			padding: 20px;

			box-sizing: border-box;
		}
		.photo .side-front{/*display: none;*/}
		.photo .side-front .image{
			width: 100%;
			height: 250px;
			line-height: 250px;
			overflow: hidden;
		}

		.photo .side-front .image img{
			width: 100%;
		}
		.photo .side-front .caption{
			text-align: center;
			font-size: 16px;
			line-height: 50px;
		}
		.photo .side-back{
			/*display: none;*/
		}
		.photo .side-back .desc{
			color: #666;
			font-size: 14px;
			line-height: 1.5em;
		}

		/*当前选中的海报样式*/
		.photo_center{
			left: 50%;
			top: 50%;
			margin: -160px 0 0 -130px;
			z-index: 999;
		}

		/*负责照片旋转*/
		.photo-wrap{
			position: absolute;
			width: 100%;
			height: 100%;

			-webkit-transform-style: preserve-3d;
			-webkit-transition: all .6s;
		}

		.photo-wrap .side-front{
			-webkit-transform: rotateY(0deg);
		}
		.photo-wrap .side-back{
			-webkit-transform: rotateY(180deg);
		}
		.photo-wrap .side{
			-webkit-backface-visibility:hidden;
		}

		.photo_front .photo-wrap{
			-webkit-transform: rotateY(0deg);
		}
		.photo_back .photo-wrap{
			-webkit-transform: rotateY(180deg);
		}
	</style>
</head>
<body onselectstart="return false;">
	<div class="content">
		<!-- 2.改写视图，为模板字符串 -->
		<div class="wrap" id="wrap">
			<div class="photo photo_front" onclick="turn(this)" id="photo_{{index}}">
				<div class="photo-wrap">
					<div class="side side-front">
						<p class="image">
							<img src="photo/{{img}}">
						</p>
						<p class="caption">{{caption}}</p>
					</div>
					<div class="side side-back">
						<p class="desc">{{desc}}</p>
					</div>
				</div>
			</div>
		</div>
	</div>
<script type="text/javascript" src="./photo/data.js"></script>
<script type="text/javascript">
	//1.翻面控制
	function turn(elem){
		var cls = elem.className;
		if (/photo_front/.test(cls)){//正则表达式检测是否传进来"photo photo_center photo_front"这一串表达式。上面的this指的是他所在当前的div所有class。//
			cls = cls.replace(/photo_front/, 'photo_back')
		} else {
			cls = cls.replace(/photo_back/, 'photo_front')
		}

		return elem.className = cls;
	}

	//3.通用函数，用来获取标签
	function g(selector){
		var method = selector.substr(0,1) == '.' ? 'getElementsByClassName' : 'getElementById';
		return document[method](selector.substr(1));
	}

	//4. 输出所有的海报
	var data = data;
	function addPhotos(){
		var template = g('#wrap').innerHTML; //抓取#wrap包含的所有字符串
		var html = [];
		for(s in data){
			var _html = template
							.replace('{{index}}', s)
							.replace('{{img}}', data[s].img)
							.replace('{{caption}}', data[s].caption)
							.replace('{{desc}}', data[s].desc)
			html.push(_html);
		} 
		g('#wrap').innerHTML = html.join('');

		rsort(random([0, data.length - 1]));
	}
	addPhotos();

	//6.计算左右分区的范围
	function range(){
		var range = {left:{ x:[], y:[]}, right:{ x:[], y:[]}};

		var wrap = {
			w:g('#wrap').clientWidth,
			h:g('#wrap').clientHeight
		}

		var photo = {
			w:g('.photo')[0].clientWidth,
			h:g('.photo')[0].clientHeight
		}

		range.wrap = wrap;
		range.photo = photo;

		//左半边分区
		range.left.x = [ photo.w, wrap.w/2 - 2*photo.w];
		range.left.y = [ photo.h, wrap.h - 2*photo.h];

		//右半边分区
		range.right.x = [wrap.w/2 + photo.w, wrap.w];
		range.right.y = range.left.y;

		return range;
	}

// 	//5. 排序海报
	function rsort(n){
		var _photo = g('.photo');//存储所有海报内容
		var photos = [];

		for(s = 0; s < _photo.length; s++){
			_photo[s].className = _photo[s].className.replace(/\s*photo_center\s*/, ' ');//把所有的元素中原有的photo_center样式用空格替换，也就是删除它。

			photos.push(_photo[s]);
		}

		var photo_center = g('#photo_' + n);
		photo_center.className += ' photo_center';

		photo_center = photos.splice(n,1)[0];

		//分左右区域
		var photos_left = photos.splice(0, Math.ceil(photos.length/2));
		var photos_right = photos;
console.log(photos_left.length, photos_right.length);

		var ranges = range();

		for(s in photos_left){
			var photo = photos_left[s];

			if(photo = photos_left[0]){
				photo.style.left = random([50, 200]) + 'px';
				photo.style.top = random(ranges.left.y) + 'px';
			} 
			if(photo = photos_left[1]){
				photo.style.left = random([200, 500]) + 'px';
				photo.style.top = random(ranges.left.y) + 'px';
			}

			//photo.style['-webkit-transform'] = 'rotate('+ random([0, 20]) + 'deg)';
		}

		for(s in photos_right){
			var photo = photos_right[s];

			photo.style.left = random(ranges.right.x) + 'px';
			photo.style.top = random(ranges.right.y) + 'px';

			photo.style['-webkit-transform'] = 'rotate('+ random([0, 20]) + 'deg)';
		}	
	}



	//随机生成一个值,random支持取值范围。random（[min， max]）
	function random(range){
		var max = Math.max(range[0], range[1]);
		var min = Math.min(range[0], range[1]);

		var diff = max - min;

		var number = Math.ceil( (Math.random()*diff + min));

		return number;
	}
</script>
</body>
</html>